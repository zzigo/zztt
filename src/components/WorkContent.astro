---
import { getEntry } from 'astro:content';

const { slug } = Astro.props;

let html = '';
let found = true;

if (slug) {
  try {
    const entry = await getEntry('works', slug);
    if (!entry) {
      found = false;
    } else {
      const rendered = await entry.render();

      // IMPORTANT: rendered.rendered.html is where the HTML lives
      const rawHtml = rendered.rendered?.html;

      if (typeof rawHtml === 'string') {
        html = rawHtml
          .replace(/<audio[\s\S]*?<\/audio>/gi, '')
          .replace(/<video[\s\S]*?<\/video>/gi, '')
          .replace(/<iframe[\s\S]*?<\/iframe>/gi, '')
          .replace(/<source[\s\S]*?>/gi, '')
          .replace(/\sautoplay(\s|>)/gi, '>')
          .replace(/\scontrols(\s|>)/gi, '>');
      } else {
        console.warn(`WorkContent: no HTML rendered for slug "${slug}"`);
        found = false;
      }
    }
  } catch (e) {
    console.error(`WorkContent: could not load slug "${slug}"`);
    console.error(e);
    found = false;
  }
} else {
  found = false;
}
---
{found ? (
  <div class="prose" set:html={html}></div>
) : (
  <p>Content not found.</p>
)}

<style is:global>
.prose {
  color: white;
  line-height: 1.6;
  max-width: 100%;
}
.prose h1,
.prose h2,
.prose h3 {
  color: #ccc;
  border-bottom: 1px solid #555;
  padding-bottom: 0.3em;
}
.prose a {
  color: #f89;
  text-decoration: none;
}
.prose a:hover {
  text-decoration: underline;
}
.prose img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
}
.prose p {
  margin-block-start: 1em;
  margin-block-end: 1em;
}
.prose header,
.prose footer,
.prose nav,
.prose .header,
.prose .footer {
  display: none !important;
}
</style>